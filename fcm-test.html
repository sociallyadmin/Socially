<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCM Test - Socially</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f1b9ba; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .alert { background: #f0ad4e; color: white; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üî• Firebase Cloud Messaging Test</h1>
    
    <div class="alert">
        ‚ö†Ô∏è <strong>Important:</strong> This test page must be served over HTTPS or localhost to work properly. 
        File:// URLs don't support service workers. 
        <br><br>
        <strong>To test properly:</strong>
        <ol>
            <li>Start your development server: <code>npm start</code></li>
            <li>Or serve this page via a local server</li>
            <li>Visit the actual application at https://sociallyapp.org</li>
        </ol>
    </div>
    
    <div id="status"></div>
    
    <h2>Quick Checks</h2>
    <button onclick="checkEnvironment()">Check Environment</button>
    <button onclick="checkPermissions()">Check Permissions</button>
    <button onclick="instructPermissions()">Enable Notifications</button>
    
    <h2>Configuration</h2>
    <pre id="config"></pre>
    
    <h2>Results</h2>
    <div id="results"></div>

    <script>
        // Display configuration without Firebase imports (since file:// doesn't work)
        const config = {
            projectId: 'socially-843c5',
            senderId: '896178106524',
            vapidKey: 'BAkbtHR6tCqMUiBaJGAL...',
            currentURL: window.location.href,
            protocol: window.location.protocol,
            userAgent: navigator.userAgent.substring(0, 100) + '...'
        };
        
        document.getElementById('config').textContent = JSON.stringify(config, null, 2);

        function addResult(type, message) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${type.toUpperCase()}:</strong> ${message}`;
            document.getElementById('results').appendChild(div);
            console.log(`[${type}] ${message}`);
        }

        function checkEnvironment() {
            addResult('info', 'Checking environment compatibility...');
            
            const protocol = window.location.protocol;
            if (protocol === 'file:') {
                addResult('error', 'File:// protocol detected. Service Workers require HTTPS or localhost.');
                addResult('warning', 'Please serve this page from a web server or test in the actual application.');
                return false;
            } else if (protocol === 'https:' || window.location.hostname === 'localhost') {
                addResult('success', `Secure context detected: ${protocol}`);
            } else {
                addResult('warning', `Insecure context: ${protocol}. Some features may not work.`);
            }
            
            if ('serviceWorker' in navigator) {
                addResult('success', 'Service Worker API supported');
            } else {
                addResult('error', 'Service Worker API not supported');
            }
            
            if ('Notification' in window) {
                addResult('success', 'Notification API supported');
            } else {
                addResult('error', 'Notification API not supported');
            }
            
            if ('PushManager' in window) {
                addResult('success', 'Push Manager API supported');
            } else {
                addResult('error', 'Push Manager API not supported');
            }
            
            return true;
        }

        function checkPermissions() {
            addResult('info', 'Checking current permissions...');
            
            const permission = Notification.permission;
            
            switch(permission) {
                case 'granted':
                    addResult('success', 'Notification permission: GRANTED ‚úÖ');
                    break;
                case 'denied':
                    addResult('error', 'Notification permission: DENIED ‚ùå');
                    addResult('warning', 'Notifications are blocked. You need to manually enable them in browser settings.');
                    break;
                case 'default':
                    addResult('warning', 'Notification permission: NOT ASKED YET');
                    addResult('info', 'Click "Enable Notifications" to request permission.');
                    break;
            }
        }

        function instructPermissions() {
            addResult('info', 'Instructions for enabling notifications...');
            
            if (Notification.permission === 'denied') {
                addResult('warning', 'Notifications are currently blocked. To enable:');
                addResult('info', 'Chrome: Click the lock icon in address bar ‚Üí Notifications ‚Üí Allow');
                addResult('info', 'Firefox: Click shield icon ‚Üí Permissions ‚Üí Notifications ‚Üí Allow');
                addResult('info', 'Safari: Safari menu ‚Üí Preferences ‚Üí Websites ‚Üí Notifications');
            } else if (Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        addResult('success', 'Notification permission granted! üéâ');
                        new Notification('Test Notification', {
                            body: 'Notifications are now working!',
                            icon: '/favicon.ico'
                        });
                    } else {
                        addResult('error', 'Permission denied. See instructions above.');
                    }
                });
            } else {
                addResult('success', 'Notifications are already enabled!');
                new Notification('Test Notification', {
                    body: 'This is a test notification',
                    icon: '/favicon.ico'
                });
            }
        }

        // Auto-run environment check
        setTimeout(checkEnvironment, 500);
        setTimeout(checkPermissions, 1000);
    </script>
</body>
</html>